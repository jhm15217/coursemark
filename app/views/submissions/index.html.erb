<%= render "assignments/header" %>

<table class="submissions">
  <tr>
    <th>First name</th>
    <th>Last name</th>
    <th>Submitted</th>
    <th>Reviews Received</th>
    <th>Grade</th>
    <th>Reviews Given</th>

  </tr>
  <% @students.each do |student| %>
      <tr>
        <td><%= student.first_name %></td>
        <td><%= student.last_name %></td>
        <% submission = @assignment.get_submission(student) %>
        <% if submission %>
            <td><%= submission.created_at.to_s(:pretty) %></td>
            <td><a href=<%= "/courses/#{@course.id}/assignments/#{@assignment.id}/submissions/#{submission.id}?instructor=true" %>>
              <%= @assignment.evaluations.forSubmission(submission).select {|evaluation| evaluation.finished?}.length %> / <%= @assignment.evaluations.forSubmission(submission).length %></a>
            </td>
            <td>
              <%= unless g = submission.grade.blank? then g.to_s + '%' else "--" end %>
              <% if submission.instructor_approved %><div class="checkmark"></div><% end %>
            </td>
        <% else %>
            <td>--</td>
            <td>--</td>
            <td>--</td>
        <% end %>
        <td>
          <% unless student.pseudo %>
              <%if (completed_review_count = @assignment.evaluations.forUser(student).select {|evaluation| evaluation.finished?}.length) > 0 %>
                  <a href=<%= "/courses/#{@course.id}/assignments/#{@assignment.id}?reviewer=#{student.id}" %>>
                    <%= completed_review_count.to_s + "/" + @assignment.evaluations.forUser(student).length.to_s %></a>
              <% else %>
                  0/<%= @assignment.evaluations.forUser(student).length.to_s %>
              <% end %>
          <% end %>
        </td>
      </tr>
  <% end %>

</table>
<br />
<%= link_to :controller => "assignments", :action => "export" do %>
    <div class='button' style="float: left;">
      Export Grades CSV
    </div>
<% end %>




