<%= render "assignments/header" %>

<!-- User is not instructor -->

<% if @to_do.length > 0 %>
    <div class="toDoList" >
      <h3>To-Do List</h3>
      <ul class="toDoUl">
        <% @to_do.each do |task| %>

            <% hours_remain = ((task[:time] - Time.zone.now) / 1.hour).round %>
            <% if hours_remain < 25 then remaining = hours_remain.to_s + ' hours ' else remaining = (hours_remain/24).to_s + ' days ' end %>
            <%= ((if task[:action] == :submit  then
                    "<a href=/courses/#{@course.id}/assignments/#{task[:assignment].id}><li>
                    <div class='a_name'>Submit #{task[:assignment].name + (task[:team] ? ' for ' + task[:team] : '')}"
                  else
                    "<a href=/courses/#{@course.id}/assignments/#{task[:assignment].id}/submissions/#{task[:submission_id]}><div class='a_name'>Complete Review #{task[:index].to_s} for #{task[:assignment].name}"
                  end) +
                    '</div> by ' + task[:time].strftime('%A (%-m/%-d) at %I:%M %p') + ' (<span class="red">' + remaining  + 'left</span>) </a>').html_safe
            %>
            </li>
        <% end %>
      </ul>
    </div>
<% end %>

<% if (Time.zone.now < @assignment.submission_due) %>
    <%= render 'submission' %>
<% end %>


<% if @submissions.length > 0 %>
    <h3 class='assignment_section_header'>Your Submission(s)</h3>
    <% @submissions.each do |submission| %>
        <div id="reviewing_task">
          <%= link_to course_assignment_submission_path(@course, @assignment, submission) + '?view=true' do %>
              <%= submission.user.name + "'s" +
                          ((e = submission.evaluations.select{|e| e.finished }.length) > 0 ? (" with " + e.to_s + ' review(s)') : '')  %>
          <% end %>
        </div>
    <% end %>
<% end %>


<br>


<% if @assignment.reviewers_assigned %>
    <div id="reviewing_tasks">
      <% if @reviewing_tasks.length > 0 %>
          <h3 class='assignment_section_header'>Reviews by You</h3>
          <% @reviewing_tasks.each_with_index do |task, index| %>
              <div id="reviewing_task">
                <%= link_to course_assignment_submission_path(@course, @assignment, task.submission) do %>
                    <%= ((task.finished? or Time.zone.now > @assignment.review_due) ? 'See' : 'Complete') + ' Review ' + (index + 1).to_s %>
                <% end %>
              </div>
          <% end %>
      <% end %>
    </div>
<% end %>

<!--<div class="clearfix"></div>-->


<% if Time.zone.now < @assignment.submission_due %>
    <h3 class='assignment_section_header'>Reviewing Rubric</h3>
    <% @questions.each do |question| %>
        <div class='submissionQuestionBox clearfix'>
          <h2><%= question.question_text %></h2>
          <div class='possiblePoints'><%= question.question_weight %> Points</div>
          <ul class='rubricScale'>
            <% question.scales.sort_by{|s| s.value}.each do |scale|  %>
                <li><%= scale.value.to_s + '%: ' + scale.description  %></li>
            <% end %>
          </ul>
        </div>
    <% end %>
<% end %>



